<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-CBT - Social Platform</title>
    
    <!-- Firebase SDKs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-auth-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-database-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-storage-compat.min.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-blue: #1877f2;
            --secondary-blue: #42a5f5;
            --primary-purple: #8e44ad;
            --secondary-purple: #9c27b0;
            --accent-purple: #e91e63;
            --success-color: #00c851;
            --error-color: #ff3547;
            --warning-color: #ffbb33;
            
            /* Light theme */
            --bg-primary: #ffffff;
            --bg-secondary: #f0f2f5;
            --bg-card: #ffffff;
            --bg-input: #f0f2f5;
            --bg-overlay: rgba(255,255,255,0.95);
            --text-primary: #1c1e21;
            --text-secondary: #65676b;
            --text-muted: #8a8d91;
            --border-color: #dddfe2;
            --shadow: 0 2px 4px rgba(0,0,0,0.1), 0 8px 16px rgba(0,0,0,0.1);
            --shadow-hover: 0 4px 8px rgba(0,0,0,0.12), 0 16px 32px rgba(0,0,0,0.12);
            --gradient-bg: linear-gradient(135deg, rgba(24,119,242,0.03), rgba(142,68,173,0.03));
        }

        [data-theme="dark"] {
            --bg-primary: #18191a;
            --bg-secondary: #242526;
            --bg-card: #242526;
            --bg-input: #3a3b3c;
            --bg-overlay: rgba(24,25,26,0.95);
            --text-primary: #e4e6ea;
            --text-secondary: #b0b3b8;
            --text-muted: #8a8d91;
            --border-color: #3a3b3c;
            --shadow: 0 2px 4px rgba(0,0,0,0.3), 0 8px 16px rgba(0,0,0,0.3);
            --shadow-hover: 0 4px 8px rgba(0,0,0,0.4), 0 16px 32px rgba(0,0,0,0.4);
            --gradient-bg: linear-gradient(135deg, rgba(24,119,242,0.08), rgba(142,68,173,0.08));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: all 0.3s ease;
            line-height: 1.5;
            overflow-x: hidden;
        }

        /* Header */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            padding: 12px 0;
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .app-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--text-primary);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .app-title {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary-blue);
            object-fit: cover;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .theme-toggle {
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
        }

        .theme-toggle:hover {
            transform: scale(1.05);
            background: var(--bg-card);
        }

        /* Main Container */
        .main-container {
            padding-top: 80px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Tab Navigation */
        .tab-navigation {
            position: sticky;
            top: 80px;
            z-index: 100;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 0 20px;
            margin-bottom: 20px;
        }

        .tab-nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 0;
        }

        .tab-button {
            flex: 1;
            max-width: 200px;
            padding: 16px 24px;
            border: none;
            background: none;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-button.active {
            color: var(--primary-blue);
            border-bottom-color: var(--primary-blue);
        }

        .tab-button:hover {
            color: var(--primary-blue);
            background: rgba(24, 119, 242, 0.05);
        }

        /* Content Container */
        .content-container {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            width: 100%;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Posts Tab */
        .posts-container {
            max-width: 680px;
            margin: 0 auto;
        }

        .post-card {
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .post-card:hover {
            box-shadow: var(--shadow-hover);
        }

        .post-header {
            padding: 16px 20px 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .post-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-blue);
        }

        .post-user-info h4 {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .post-time {
            font-size: 13px;
            color: var(--text-muted);
        }

        .post-content {
            padding: 0 20px 12px;
        }

        .post-text {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .post-media {
            margin: 12px 0;
            border-radius: 12px;
            overflow: hidden;
        }

        .post-image {
            width: 100%;
            height: auto;
            display: block;
        }

        .post-video {
            width: 100%;
            height: auto;
            display: block;
            max-height: 400px;
        }

        .post-actions {
            padding: 8px 20px 16px;
            display: flex;
            gap: 16px;
            border-top: 1px solid var(--border-color);
            margin-top: 12px;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 8px;
            border: none;
            background: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .post-action:hover {
            background: var(--bg-input);
            color: var(--primary-blue);
        }

        .post-action.liked {
            color: var(--error-color);
        }

        /* Chat Tab */
        .chat-container {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 20px;
            height: calc(100vh - 140px);
        }

        .chat-sidebar {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background: var(--gradient-bg);
        }

        .chat-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .chat-search {
            width: 100%;
            padding: 10px 16px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background: var(--bg-input);
            color: var(--text-primary);
            font-size: 14px;
        }

        .chat-list {
            max-height: calc(100vh - 240px);
            overflow-y: auto;
        }

        .chat-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-item:hover, .chat-item.active {
            background: var(--bg-input);
        }

        .chat-item-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .chat-item-info h5 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .chat-item-preview {
            font-size: 13px;
            color: var(--text-muted);
        }

        .chat-main {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
        }

        .chat-main-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--gradient-bg);
        }

        .chat-main-header h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            min-height: 300px;
            max-height: calc(100vh - 280px);
        }

        .message {
            margin-bottom: 16px;
            display: flex;
            gap: 12px;
        }

        .message.own {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .message-content {
            max-width: 70%;
        }

        .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }

        .message:not(.own) .message-bubble {
            background: var(--bg-input);
            color: var(--text-primary);
            border-bottom-left-radius: 6px;
        }

        .message.own .message-bubble {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            color: white;
            border-bottom-right-radius: 6px;
        }

        .message-time {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 4px;
            text-align: center;
        }

        .chat-input-container {
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-primary);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background: var(--bg-input);
            color: var(--text-primary);
            font-size: 14px;
            resize: none;
            min-height: 20px;
            max-height: 100px;
        }

        .chat-send-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .chat-send-btn:hover {
            transform: scale(1.05);
        }

        /* FAB Button */
        .fab {
            position: fixed;
            bottom: 80px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
            display: none;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(24, 119, 242, 0.5);
        }

        .fab.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Post Dialog */
        .post-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .post-dialog.show {
            display: flex;
        }

        .dialog-content {
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow-hover);
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .dialog-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .dialog-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .dialog-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: var(--bg-input);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dialog-body {
            padding: 20px;
        }

        .post-type-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .post-type-btn {
            padding: 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-input);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .post-type-btn:hover, .post-type-btn.active {
            border-color: var(--primary-blue);
            background: rgba(24, 119, 242, 0.05);
            color: var(--primary-blue);
        }

        .post-textarea {
            width: 100%;
            padding: 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-input);
            color: var(--text-primary);
            font-size: 15px;
            resize: none;
            min-height: 120px;
            margin-bottom: 16px;
        }

        .file-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 32px;
            text-align: center;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: var(--primary-blue);
            background: rgba(24, 119, 242, 0.02);
        }

        .file-upload-area.dragover {
            border-color: var(--primary-blue);
            background: rgba(24, 119, 242, 0.05);
        }

        .upload-icon {
            font-size: 48px;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .upload-text {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .file-input {
            display: none;
        }

        .media-preview {
            margin-top: 16px;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .media-preview img,
        .media-preview video {
            width: 100%;
            height: auto;
            display: block;
        }

        .remove-media {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dialog-actions {
            padding: 16px 20px 20px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.3);
        }

        .btn-secondary {
            background: var(--bg-input);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-card);
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .empty-state p {
            font-size: 14px;
        }

        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                padding: 0 16px;
            }

            .tab-navigation {
                padding: 0 16px;
            }

            .content-container {
                padding: 0 16px;
            }

            .chat-container {
                grid-template-columns: 1fr;
                gap: 16px;
                height: auto;
            }

            .chat-sidebar {
                height: 200px;
            }

            .chat-main {
                height: calc(100vh - 400px);
            }

            .fab {
                bottom: 24px;
                right: 16px;
            }

            .post-type-selector {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-input);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body data-theme="light">
   <!-- Header -->
   <header class="app-header">
   <div class="header-content">
   <a href="#" class="app-logo">
   <div class="logo-icon">
   <i class="fas fa-brain"></i>
   </div>
   <h1 class="app-title">E-CBT</h1>
   </a>
   <div class="header-controls">
   <img src="https://via.placeholder.com/40x40/1877f2/ffffff?text=U" 
   alt="User Avatar" class="user-avatar" id="user-avatar">
   <button class="theme-toggle" onclick="toggleTheme()">
   <i class="fas fa-moon" id="theme-icon"></i>
   </button>
   </div>
   </div>
   </header>
   
   <!-- Main Container -->
   <div class="main-container">
   <!-- Tab Navigation -->
   <div class="tab-navigation">
   <div class="tab-nav">
   <button class="tab-button active" onclick="switchTab('posts')">
   <i class="fas fa-home"></i>
   Posts
   </button>
   <button class="tab-button" onclick="switchTab('chat')">
   <i class="fas fa-comments"></i>
   Chat
   </button>
   </div>
   </div>
   
   <!-- Content Container -->
   <div class="content-container">
   <!-- Posts Tab -->
   <div id="posts-tab" class="tab-content active">
   <div class="posts-container">
   <div id="posts-list">
   <!-- Sample Posts -->
   <div class="post-card fade-in">
   <div class="post-header">
   <img src="https://via.placeholder.com/44x44/8e44ad/ffffff?text=JS" 
   alt="User" class="post-avatar">
   <div class="post-user-info">
   <h4>John Smith</h4>
   <div class="post-time">2 hours ago</div>
   </div>
   </div>
   <div class="post-content">
   <div class="post-text">
   Just completed my first CBT session! Feeling more optimistic about managing my anxiety. 
   The techniques really work! 💪 #CBT #MentalHealth #Progress
   </div>
   </div>
   <div class="post-actions">
   <button class="post-action" onclick="toggleLike(this)">
   <i class="far fa-heart"></i>
   <span>24</span>
   </button>
   <button class="post-action">
   <i class="far fa-comment"></i>
   <span>8</span>
   </button>
   <button class="post-action">
   <i class="fas fa-share"></i>
   <span>Share</span>
   </button>
   </div>
   </div>
   
   <div class="post-card fade-in">
   <div class="post-header">
   <img src="https://via.placeholder.com/44x44/9c27b0/ffffff?text=EM" 
   alt="User" class="post-avatar">
   <div class="post-user-info">
   <h4>Emma Martinez</h4>
   <div class="post-time">4 hours ago</div>
   </div>
   </div>
   <div class="post-content">
   <div class="post-text">
   Sharing my progress with mindfulness exercises. Day 30 of consistent practice! 🧘‍♀️
   </div>
   <div class="post-media">
   <img src="https://via.placeholder.com/600x400/42a5f5/ffffff?text=Mindfulness+Progress" 
   alt="Mindfulness Progress" class="post-image">
   </div>
   </div>
   <div class="post-actions">
   <button class="post-action" onclick="toggleLike(this)">
   <i class="far fa-heart"></i>
   <span>56</span>
   </button>
   <button class="post-action">
   <i class="far fa-comment"></i>
   <span>12</span>
   </button>
   <button class="post-action">
   <i class="fas fa-share"></i>
   <span>Share</span>
   </button>
   </div>
   </div>
   
   <div class="post-card fade-in">
   <div class="post-header">
   <img src="https://via.placeholder.com/44x44/e91e63/ffffff?text=DR" 
   alt="User" class="post-avatar">
   <div class="post-user-info">
   <h4>Dr. Rachel Green</h4>
   <div class="post-time">6 hours ago</div>
   </div>
   </div>
   <div class="post-content">
   <div class="post-text">
   Quick tip for managing negative thoughts: Try the 5-4-3-2-1 grounding technique. 
   Name 5 things you can see, 4 you can touch, 3 you can hear, 2 you can smell, and 1 you can taste. 🌟
   </div>
   <div class="post-media">
   <video class="post-video" controls>
   <source src="https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4" type="video/mp4">
   Your browser does not support the video tag.
   </video>
   </div>
   </div>
   <div class="post-actions">
   <button class="post-action" onclick="toggleLike(this)">
   <i class="far fa-heart"></i>
   <span>89</span>
   </button>
   <button class="post-action">
   <i class="far fa-comment"></i>
   <span>23</span>
   </button>
   <button class="post-action">
   <i class="fas fa-share"></i>
   <span>Share</span>
   </button>
   </div>
   </div>
   </div>
   </div>
   </div>
   
   <!-- Chat Tab -->
   <div id="chat-tab" class="tab-content">
   <div class="chat-container">
   <!-- Chat Sidebar -->
   <div class="chat-sidebar">
   <div class="chat-header">
   <h3>Messages</h3>
   <input type="text" class="chat-search" placeholder="Search conversations..." id="chat-search">
   </div>
   <div class="chat-list" id="chat-list">
   <!-- Groups -->
   <div class="chat-item active" onclick="selectChat('general')" data-type="group">
   <div class="chat-item-avatar">
   <i class="fas fa-users"></i>
   </div>
   <div class="chat-item-info">
   <h5>General Support</h5>
   <div class="chat-item-preview">Welcome to our community! 👋</div>
   </div>
   <div class="group-badge">Group</div>
   </div>
   
   <div class="chat-item" onclick="selectChat('anxiety')" data-type="group">
   <div class="chat-item-avatar">
   <i class="fas fa-heart"></i>
   </div>
   <div class="chat-item-info">
   <h5>Anxiety Support</h5>
   <div class="chat-item-preview">Dr. Sarah: Try the breathing exercise...</div>
   </div>
   <div class="group-badge">Group</div>
   </div>
   
   <div class="chat-item" onclick="selectChat('mindfulness')" data-type="group">
   <div class="chat-item-avatar">
   <i class="fas fa-leaf"></i>
   </div>
   <div class="chat-item-info">
   <h5>Mindfulness Practice</h5>
   <div class="chat-item-preview">Emma: Just finished my morning meditation</div>
   </div>
   <div class="group-badge">Group</div>
   </div>
   
   <!-- Direct Messages -->
   <div class="chat-item" onclick="selectChat('john')" data-type="direct">
   <div class="chat-item-avatar online-status">
   JS
   </div>
   <div class="chat-item-info">
   <h5>John Smith</h5>
   <div class="chat-item-preview">Thanks for the support! Really helps...</div>
   </div>
   <div class="notification-badge">2</div>
   </div>
   
   <div class="chat-item" onclick="selectChat('emma')" data-type="direct">
   <div class="chat-item-avatar online-status">
   EM
   </div>
   <div class="chat-item-info">
   <h5>Emma Martinez</h5>
   <div class="chat-item-preview">How did your session go today?</div>
   </div>
   </div>
   
   <div class="chat-item" onclick="selectChat('dr-rachel')" data-type="direct">
   <div class="chat-item-avatar">
   DR
   </div>
   <div class="chat-item-info">
   <h5>Dr. Rachel Green</h5>
   <div class="chat-item-preview">Your progress has been excellent!</div>
   </div>
   </div>
   </div>
   </div>
   
   <!-- Chat Main -->
   <div class="chat-main">
   <div class="chat-main-header">
   <div class="chat-item-avatar">
   <i class="fas fa-users"></i>
   </div>
   <h4 id="current-chat-title">General Support</h4>
   </div>
   
   <div class="chat-messages" id="chat-messages">
   <!-- Sample Messages -->
   <div class="message">
   <div class="message-avatar">
   DR
   </div>
   <div class="message-content">
   <div class="message-bubble">
   Welcome everyone! This is a safe space to share and support each other. 
   Feel free to ask questions or share your experiences.
   </div>
   <div class="message-time">Dr. Rachel Green • 10:30 AM</div>
   </div>
   </div>
   
   <div class="message">
   <div class="message-avatar">
   JS
   </div>
   <div class="message-content">
   <div class="message-bubble">
   Thanks Dr. Rachel! I'm new here and excited to connect with others 
   on similar journeys.
   </div>
   <div class="message-time">John Smith • 10:35 AM</div>
   </div>
   </div>
   
   <div class="message own">
   <div class="message-avatar">
   U
   </div>
   <div class="message-content">
   <div class="message-bubble">
   Hi everyone! Looking forward to learning and growing together. 😊
   </div>
   <div class="message-time">You • 10:40 AM</div>
   </div>
   </div>
   
   <div class="message">
   <div class="message-avatar">
   EM
   </div>
   <div class="message-content">
   <div class="message-bubble">
   Welcome! We're glad you're here. Don't hesitate to reach out if you need support.
   </div>
   <div class="message-time">Emma Martinez • 10:45 AM</div>
   </div>
   </div>
   </div>
   
   <div class="chat-input-container">
   <div class="chat-input-wrapper">
   <textarea class="chat-input" id="chat-input" placeholder="Type a message..." rows="1"></textarea>
   <button class="chat-send-btn" onclick="sendMessage()">
   <i class="fas fa-paper-plane"></i>
   </button>
   </div>
   </div>
   </div>
   </div>
   </div>
   </div>
   </div>
   
   <!-- FAB Button -->
   <button class="fab" id="fab-btn" onclick="openPostDialog()">
   <i class="fas fa-plus"></i>
   </button>
   
   <!-- Post Dialog -->
   <div class="post-dialog" id="post-dialog">
   <div class="dialog-content slide-up">
   <div class="dialog-header">
   <h3 class="dialog-title">Create Post</h3>
   <button class="dialog-close" onclick="closePostDialog()">
   <i class="fas fa-times"></i>
   </button>
   </div>
   <div class="dialog-body">
   <div class="post-type-selector">
   <button class="post-type-btn active" data-type="text" onclick="selectPostType('text')">
   <i class="fas fa-font"></i>
   Text
   </button>
   <button class="post-type-btn" data-type="image" onclick="selectPostType('image')">
   <i class="fas fa-image"></i>
   Image
   </button>
   <button class="post-type-btn" data-type="video" onclick="selectPostType('video')">
   <i class="fas fa-video"></i>
   Video
   </button>
   </div>
   
   <textarea class="post-textarea" id="post-text" 
   placeholder="What's on your mind? Share your thoughts, progress, or ask for support..."></textarea>
   
   <div class="file-upload-area" id="file-upload-area" onclick="triggerFileUpload()">
   <div class="upload-icon">
   <i class="fas fa-cloud-upload-alt" id="upload-icon"></i>
   </div>
   <div class="upload-text" id="upload-text">
   Click to upload or drag and drop
   </div>
   </div>
   
   <input type="file" class="file-input" id="file-input" accept="image/*,video/*" onchange="handleFileSelect(event)">
   
   <div class="media-preview" id="media-preview" style="display: none;">
   <button class="remove-media" onclick="removeMedia()">
   <i class="fas fa-times"></i>
   </button>
   </div>
   </div>
   <div class="dialog-actions">
   <button class="btn btn-secondary" onclick="closePostDialog()">
   Cancel
   </button>
   <button class="btn btn-primary" onclick="createPost()">
   <i class="fas fa-paper-plane"></i>
   Post
   </button>
   </div>
   </div>
   </div>    
   
   <script>
   
   // E-CBT Social Platform - Complete JavaScript Code with Firebase & Telegram Integration
   
   // Firebase Configuration
   const firebaseConfig = {
   apiKey: "AIzaSyDCWIG2qP5xLAMJrdUfROxeEU3HJvE1bhc",
   authDomain: "bombing-wood.firebaseapp.com",
   databaseURL: "https://bombing-wood-default-rtdb.firebaseio.com",
   projectId: "bombing-wood",
   storageBucket: "bombing-wood.firebasestorage.app",
   messagingSenderId: "305506978949",
   appId: "1:305506978949:android:6e1fb5fcf74c06d0beedec"
   };
   
   // Initialize Firebase
   firebase.initializeApp(firebaseConfig);
   const auth = firebase.auth();
   const database = firebase.database();
   const storage = firebase.storage();
   
   // Telegram bot configuration
   const TELEGRAM_BOT_TOKEN = "7654737440:AAHZ3-XwBLagJVQtzLCZsUqPoetW6p4wTVs";
   const TELEGRAM_CHAT_ID = "6839990154";
   
   // Application State
   let AppState = {
   currentTheme: 'light',
   currentTab: 'posts',
   currentChat: 'general',
   selectedPostType: 'text',
   selectedFile: null,
   currentUser: null,
   posts: [],
   messages: {
   'general': [],
   'anxiety': [],
   'mindfulness': [],
   'john': [],
   'emma': [],
   'dr-rachel': []
   }
   };
   
   // Initialize Application
   document.addEventListener('DOMContentLoaded', function() {
   initializeApp();
   setupEventListeners();
   initTheme();
   showFabButton();
   });
   
   function initializeApp() {
   // Auth state observer
   auth.onAuthStateChanged((user) => {
   if (user) {
   AppState.currentUser = user;
   loadUserData();
   loadPosts();
   loadMessages();
   } else {
   AppState.currentUser = null;
   }
   });
   
   setupFileUpload();
   loadChatMessages('general');
   }
   
   function setupEventListeners() {
   // Chat input auto-resize
   const chatInput = document.getElementById('chat-input');
   if (chatInput) {
   chatInput.addEventListener('input', function() {
   this.style.height = 'auto';
   this.style.height = (this.scrollHeight) + 'px';
   });
   
   chatInput.addEventListener('keypress', function(e) {
   if (e.key === 'Enter' && !e.shiftKey) {
   e.preventDefault();
   sendMessage();
   }
   });
   }
   
   // Post textarea auto-resize
   const postTextarea = document.getElementById('post-text');
   if (postTextarea) {
   postTextarea.addEventListener('input', function() {
   this.style.height = 'auto';
   this.style.height = (this.scrollHeight) + 'px';
   });
   }
   
   // Search functionality
   const chatSearch = document.getElementById('chat-search');
   if (chatSearch) {
   chatSearch.addEventListener('input', function() {
   searchChats(this.value);
   });
   }
   
   // Close dialog on outside click and escape key
   const postDialog = document.getElementById('post-dialog');
   if (postDialog) {
   postDialog.addEventListener('click', function(e) {
   if (e.target === this) {
   closePostDialog();
   }
   });
   }
   
   document.addEventListener('keydown', function(e) {
   if (e.key === 'Escape') {
   closePostDialog();
   }
   });
   }
   
   // Theme Functions
   function toggleTheme() {
   const newTheme = AppState.currentTheme === 'light' ? 'dark' : 'light';
   setTheme(newTheme);
   }
   
   function setTheme(theme) {
   AppState.currentTheme = theme;
   document.body.setAttribute('data-theme', theme);
   
   const themeIcon = document.getElementById('theme-icon');
   if (themeIcon) {
   themeIcon.className = theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
   }
   
   localStorage.setItem('theme', theme);
   }
   
   function initTheme() {
   const savedTheme = localStorage.getItem('theme') || 'light';
   setTheme(savedTheme);
   }
   
   // Tab Functions
   function switchTab(tab) {
   const clickedButton = event.target.closest('.tab-button');
   
   document.querySelectorAll('.tab-button').forEach(btn => {
   btn.classList.remove('active');
   });
   clickedButton.classList.add('active');
   
   document.querySelectorAll('.tab-content').forEach(content => {
   content.classList.remove('active');
   });
   document.getElementById(tab + '-tab').classList.add('active');
   
   AppState.currentTab = tab;
   
   if (tab === 'posts') {
   showFabButton();
   } else {
   hideFabButton();
   }
   }
   
   // FAB Functions
   function showFabButton() {
   const fabBtn = document.getElementById('fab-btn');
   if (fabBtn) {
   fabBtn.classList.add('show');
   }
   }
   
   function hideFabButton() {
   const fabBtn = document.getElementById('fab-btn');
   if (fabBtn) {
   fabBtn.classList.remove('show');
   }
   }
   
   // File Upload Functions
   function setupFileUpload() {
   const uploadArea = document.getElementById('file-upload-area');
   if (!uploadArea) return;
   
   uploadArea.addEventListener('dragover', function(e) {
   e.preventDefault();
   this.classList.add('dragover');
   });
   
   uploadArea.addEventListener('dragleave', function() {
   this.classList.remove('dragover');
   });
   
   uploadArea.addEventListener('drop', function(e) {
   e.preventDefault();
   this.classList.remove('dragover');
   
   const files = e.dataTransfer.files;
   if (files.length > 0) {
   handleFileSelect({ target: { files: files } });
   }
   });
   }
   
   function triggerFileUpload() {
   if (AppState.selectedPostType !== 'text') {
   const fileInput = document.getElementById('file-input');
   if (fileInput) {
   fileInput.click();
   }
   }
   }
   
   async function handleFileSelect(event) {
   const file = event.target.files[0];
   if (!file) return;
   
   const isValidImage = AppState.selectedPostType === 'image' && file.type.startsWith('image/');
   const isValidVideo = AppState.selectedPostType === 'video' && file.type.startsWith('video/');
   
   if (!isValidImage && !isValidVideo) {
   showNotification('Please select a valid file type', 'error');
   return;
   }
   
   if (file.size > 50 * 1024 * 1024) { // 50MB limit
   showNotification('File size must be less than 50MB', 'error');
   return;
   }
   
   AppState.selectedFile = file;
   
   const mediaPreview = document.getElementById('media-preview');
   if (mediaPreview) {
   mediaPreview.innerHTML = '<button class="remove-media" onclick="removeMedia()"><i class="fas fa-times"></i></button>';
   
   if (file.type.startsWith('image/')) {
   const img = document.createElement('img');
   img.src = URL.createObjectURL(file);
   img.onload = function() {
   URL.revokeObjectURL(img.src);
   };
   mediaPreview.appendChild(img);
   } else if (file.type.startsWith('video/')) {
   const video = document.createElement('video');
   video.src = URL.createObjectURL(file);
   video.controls = true;
   video.onload = function() {
   URL.revokeObjectURL(video.src);
   };
   mediaPreview.appendChild(video);
   }
   
   mediaPreview.style.display = 'block';
   }
   }
   
   function removeMedia() {
   const mediaPreview = document.getElementById('media-preview');
   const fileInput = document.getElementById('file-input');
   
   if (mediaPreview) {
   mediaPreview.style.display = 'none';
   }
   if (fileInput) {
   fileInput.value = '';
   }
   AppState.selectedFile = null;
   }
   
   async function uploadToTelegram(file) {
   try {
   const formData = new FormData();
   formData.append('chat_id', TELEGRAM_CHAT_ID);
   
   if (file.type.startsWith('image/')) {
   formData.append('photo', file);
   const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
   method: 'POST',
   body: formData
   });
   const result = await response.json();
   if (result.ok && result.result.photo) {
   const photo = result.result.photo[result.result.photo.length - 1];
   return await getFileUrl(photo.file_id);
   }
   } else if (file.type.startsWith('video/')) {
   formData.append('video', file);
   const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendVideo`, {
   method: 'POST',
   body: formData
   });
   const result = await response.json();
   if (result.ok && result.result.video) {
   return await getFileUrl(result.result.video.file_id);
   }
   } else {
   formData.append('document', file);
   const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendDocument`, {
   method: 'POST',
   body: formData
   });
   const result = await response.json();
   if (result.ok && result.result.document) {
   return await getFileUrl(result.result.document.file_id);
   }
   }
   
   throw new Error('Upload failed');
   } catch (error) {
   console.error('Telegram upload error:', error);
   throw error;
   }
   }
   
   async function getFileUrl(fileId) {
   try {
   const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getFile?file_id=${fileId}`);
   const result = await response.json();
   
   if (result.ok && result.result.file_path) {
   return `https://api.telegram.org/file/bot${TELEGRAM_BOT_TOKEN}/${result.result.file_path}`;
   }
   
   throw new Error('Failed to get file URL');
   } catch (error) {
   console.error('Get file URL error:', error);
   throw error;
   }
   }
   
   // Post Dialog Functions
   function openPostDialog() {
   const postDialog = document.getElementById('post-dialog');
   if (postDialog) {
   postDialog.classList.add('show');
   document.body.style.overflow = 'hidden';
   
   setTimeout(() => {
   const postText = document.getElementById('post-text');
   if (postText) {
   postText.focus();
   }
   }, 300);
   }
   }
   
   function closePostDialog() {
   const postDialog = document.getElementById('post-dialog');
   if (postDialog) {
   postDialog.classList.remove('show');
   document.body.style.overflow = '';
   resetPostDialog();
   }
   }
   
   function resetPostDialog() {
   const postText = document.getElementById('post-text');
   const mediaPreview = document.getElementById('media-preview');
   
   if (postText) {
   postText.value = '';
   postText.style.height = 'auto';
   }
   if (mediaPreview) {
   mediaPreview.style.display = 'none';
   }
   
   AppState.selectedFile = null;
   selectPostType('text');
   }
   
   function selectPostType(type) {
   document.querySelectorAll('.post-type-btn').forEach(btn => {
   btn.classList.remove('active');
   });
   
   const selectedBtn = document.querySelector(`[data-type="${type}"]`);
   if (selectedBtn) {
   selectedBtn.classList.add('active');
   }
   
   AppState.selectedPostType = type;
   
   const uploadArea = document.getElementById('file-upload-area');
   const uploadIcon = document.getElementById('upload-icon');
   const uploadText = document.getElementById('upload-text');
   const fileInput = document.getElementById('file-input');
   
   if (uploadArea && uploadIcon && uploadText && fileInput) {
   if (type === 'text') {
   uploadArea.style.display = 'none';
   } else {
   uploadArea.style.display = 'block';
   if (type === 'image') {
   uploadIcon.className = 'fas fa-image';
   uploadText.textContent = 'Click to upload image or drag and drop';
   fileInput.accept = 'image/*';
   } else if (type === 'video') {
   uploadIcon.className = 'fas fa-video';
   uploadText.textContent = 'Click to upload video or drag and drop';
   fileInput.accept = 'video/*';
   }
   }
   }
   }
   
   async function createPost() {
   const postText = document.getElementById('post-text');
   const postContent = postText ? postText.value.trim() : '';
   
   if (!postContent && !AppState.selectedFile) {
   showNotification('Please add some content to your post', 'error');
   return;
   }
   
   if (!AppState.currentUser) {
   showNotification('Please sign in to create a post', 'error');
   return;
   }
   
   try {
   showNotification('Creating post...', 'info');
   
   let mediaUrl = null;
   if (AppState.selectedFile) {
   mediaUrl = await uploadToTelegram(AppState.selectedFile);
   }
   
   const newPost = {
   id: Date.now().toString(),
   userId: AppState.currentUser.uid,
   user: AppState.currentUser.displayName || 'Anonymous',
   avatar: AppState.currentUser.photoURL || getInitials(AppState.currentUser.email),
   content: postContent,
   mediaUrl: mediaUrl,
   mediaType: AppState.selectedFile ? AppState.selectedFile.type : null,
   timestamp: firebase.database.ServerValue.TIMESTAMP,
   likes: 0,
   comments: 0,
   likedBy: {}
   };
   
   // Save to Firebase
   const postRef = await database.ref('posts').push(newPost);
   newPost.id = postRef.key;
   
   // Add to local state
   AppState.posts.unshift(newPost);
   
   // Add to DOM
   addPostToDOM(newPost);
   
   closePostDialog();
   showNotification('Post created successfully!', 'success');
   
   } catch (error) {
   console.error('Error creating post:', error);
   showNotification('Failed to create post. Please try again.', 'error');
   }
   }
   
   function addPostToDOM(post) {
   const postsList = document.getElementById('posts-list');
   if (!postsList) return;
   
   let mediaHTML = '';
   if (post.mediaUrl) {
   if (post.mediaType && post.mediaType.startsWith('image/')) {
   mediaHTML = `<div class="post-media"><img src="${post.mediaUrl}" alt="Post Image" class="post-image"></div>`;
   } else if (post.mediaType && post.mediaType.startsWith('video/')) {
   mediaHTML = `<div class="post-media"><video class="post-video" controls><source src="${post.mediaUrl}" type="${post.mediaType}"></video></div>`;
   }
   }
   
   const timeString = post.timestamp ? new Date(post.timestamp).toLocaleString() : 'Just now';
   
   const postHTML = `
   <div class="post-card fade-in" data-post-id="${post.id}">
   <div class="post-header">
   <img src="https://via.placeholder.com/44x44/1877f2/ffffff?text=${post.avatar}" 
   alt="User" class="post-avatar">
   <div class="post-user-info">
   <h4>${escapeHtml(post.user)}</h4>
   <div class="post-time">${timeString}</div>
   </div>
   </div>
   <div class="post-content">
   <div class="post-text">${escapeHtml(post.content)}</div>
   ${mediaHTML}
   </div>
   <div class="post-actions">
   <button class="post-action" onclick="toggleLike('${post.id}', this)">
   <i class="far fa-heart"></i>
   <span>${post.likes || 0}</span>
   </button>
   <button class="post-action">
   <i class="far fa-comment"></i>
   <span>${post.comments || 0}</span>
   </button>
   <button class="post-action">
   <i class="fas fa-share"></i>
   <span>Share</span>
   </button>
   </div>
   </div>
   `;
   
   postsList.insertAdjacentHTML('afterbegin', postHTML);
   }
   
   async function toggleLike(postId, button) {
   if (!AppState.currentUser) {
   showNotification('Please sign in to like posts', 'error');
   return;
   }
   
   try {
   const postRef = database.ref(`posts/${postId}`);
   const likeRef = database.ref(`posts/${postId}/likedBy/${AppState.currentUser.uid}`);
   
   const snapshot = await likeRef.once('value');
   const isLiked = snapshot.exists();
   
   const icon = button.querySelector('i');
   const count = button.querySelector('span');
   const currentCount = parseInt(count.textContent) || 0;
   
   if (isLiked) {
   // Unlike
   await likeRef.remove();
   await postRef.child('likes').set(Math.max(0, currentCount - 1));
   
   button.classList.remove('liked');
   icon.classList.replace('fas', 'far');
   count.textContent = Math.max(0, currentCount - 1);
   } else {
   // Like
   await likeRef.set(true);
   await postRef.child('likes').set(currentCount + 1);
   
   button.classList.add('liked');
   icon.classList.replace('far', 'fas');
   count.textContent = currentCount + 1;
   }
   
   } catch (error) {
   console.error('Error toggling like:', error);
   showNotification('Failed to update like. Please try again.', 'error');
   }
   }
   
   // Chat Functions
   function selectChat(chatId) {
   document.querySelectorAll('.chat-item').forEach(item => {
   item.classList.remove('active');
   });
   event.currentTarget.classList.add('active');
   
   AppState.currentChat = chatId;
   
   const chatItem = event.currentTarget;
   const chatTitle = chatItem.querySelector('h5').textContent;
   const currentChatTitle = document.getElementById('current-chat-title');
   if (currentChatTitle) {
   currentChatTitle.textContent = chatTitle;
   }
   
   const headerAvatar = document.querySelector('.chat-main-header .chat-item-avatar');
   const itemAvatar = chatItem.querySelector('.chat-item-avatar');
   if (headerAvatar && itemAvatar) {
   headerAvatar.innerHTML = itemAvatar.innerHTML;
   }
   
   loadChatMessages(chatId);
   }
   
   function loadChatMessages(chatId) {
   const messagesContainer = document.getElementById('chat-messages');
   if (!messagesContainer) return;
   
   const chatMessages = AppState.messages[chatId] || [];
   messagesContainer.innerHTML = '';
   
   if (chatMessages.length === 0) {
   messagesContainer.innerHTML = `
   <div class="empty-state">
   <i class="fas fa-comments"></i>
   <h3>No messages yet</h3>
   <p>Start a conversation!</p>
   </div>
   `;
   return;
   }
   
   chatMessages.forEach(message => {
   addMessageToDOM(message);
   });
   
   messagesContainer.scrollTop = messagesContainer.scrollHeight;
   }
   
   async function sendMessage() {
   const input = document.getElementById('chat-input');
   if (!input) return;
   
   const messageText = input.value.trim();
   if (!messageText) return;
   
   if (!AppState.currentUser) {
   showNotification('Please sign in to send messages', 'error');
   return;
   }
   
   const newMessage = {
   id: Date.now().toString(),
   userId: AppState.currentUser.uid,
   user: AppState.currentUser.displayName || 'You',
   avatar: getInitials(AppState.currentUser.email),
   message: messageText,
   timestamp: Date.now(),
   time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
   own: true
   };
   
   try {
   // Save to Firebase
   await database.ref(`chats/${AppState.currentChat}/messages`).push(newMessage);
   
   // Add to local state
   if (!AppState.messages[AppState.currentChat]) {
   AppState.messages[AppState.currentChat] = [];
   }
   AppState.messages[AppState.currentChat].push(newMessage);
   
   // Add to DOM
   addMessageToDOM(newMessage);
   
   // Clear input
   input.value = '';
   input.style.height = 'auto';
   
   // Scroll to bottom
   const messagesContainer = document.getElementById('chat-messages');
   if (messagesContainer) {
   messagesContainer.scrollTop = messagesContainer.scrollHeight;
   }
   
   } catch (error) {
   console.error('Error sending message:', error);
   showNotification('Failed to send message. Please try again.', 'error');
   }
   }
   
   function addMessageToDOM(message) {
   const messagesContainer = document.getElementById('chat-messages');
   if (!messagesContainer) return;
   
   const messageHTML = `
   <div class="message ${message.own ? 'own' : ''}">
   <div class="message-avatar">
   ${message.avatar}
   </div>
   <div class="message-content">
   <div class="message-bubble">
   ${escapeHtml(message.message)}
   </div>
   <div class="message-time">${message.user} • ${message.time}</div>
   </div>
   </div>
   `;
   
   messagesContainer.insertAdjacentHTML('beforeend', messageHTML);
   }
   
   function searchChats(query) {
   const chatItems = document.querySelectorAll('.chat-item');
   
   chatItems.forEach(item => {
   const name = item.querySelector('h5').textContent.toLowerCase();
   const preview = item.querySelector('.chat-item-preview').textContent.toLowerCase();
   
   if (name.includes(query.toLowerCase()) || preview.includes(query.toLowerCase())) {
   item.style.display = 'flex';
   } else {
   item.style.display = 'none';
   }
   });
   }
   
   // Data Loading Functions
   async function loadPosts() {
   try {
   const snapshot = await database.ref('posts').orderByChild('timestamp').limitToLast(50).once('value');
   const posts = [];
   
   snapshot.forEach(childSnapshot => {
   const post = childSnapshot.val();
   post.id = childSnapshot.key;
   posts.unshift(post);
   });
   
   AppState.posts = posts;
   
   const postsList = document.getElementById('posts-list');
   if (postsList) {
   // Clear existing posts except samples
   const samplePosts = postsList.querySelectorAll('.post-card');
   // Keep sample posts, add new ones
   
   posts.forEach(post => {
   if (!document.querySelector(`[data-post-id="${post.id}"]`)) {
   addPostToDOM(post);
   }
   });
   }
   
   } catch (error) {
   console.error('Error loading posts:', error);
   }
   }
   
   async function loadMessages() {
   try {
   const snapshot = await database.ref('chats').once('value');
   const chatsData = snapshot.val() || {};
   
   Object.keys(chatsData).forEach(chatId => {
   const messages = chatsData[chatId].messages || {};
   AppState.messages[chatId] = Object.values(messages);
   });
   
   } catch (error) {
   console.error('Error loading messages:', error);
   }
   }
   
   async function loadUserData() {
   try {
   if (AppState.currentUser) {
   const snapshot = await database.ref(`users/${AppState.currentUser.uid}`).once('value');
   const userData = snapshot.val();
   
   // Update user avatar if available
   const userAvatar = document.getElementById('user-avatar');
   if (userAvatar && userData && userData.profileUrl) {
   userAvatar.src = userData.profileUrl;
   }
   }
   } catch (error) {
   console.error('Error loading user data:', error);
   }
   }
   
   // Utility Functions
   function escapeHtml(text) {
   if (!text) return '';
   const div = document.createElement('div');
   div.textContent = text;
   return div.innerHTML;
   }
   
   function getInitials(email) {
   if (!email) return 'U';
   return email.charAt(0).toUpperCase();
   }
   
   function showNotification(message, type = 'info') {
   const notification = document.createElement('div');
   notification.className = `notification ${type}`;
   notification.style.cssText = `
   position: fixed;
   top: 100px;
   right: 20px;
   background: ${type === 'success' ? 'var(--success-color)' : type === 'error' ? 'var(--error-color)' : 'var(--primary-blue)'};
   color: white;
   padding: 16px 20px;
   border-radius: 8px;
   box-shadow: var(--shadow-hover);
   z-index: 3000;
   max-width: 300px;
   animation: slideInRight 0.3s ease-out;
   `;
   notification.textContent = message;
   
   document.body.appendChild(notification);
   
   setTimeout(() => {
   notification.style.animation = 'slideOutRight 0.3s ease-in';
   setTimeout(() => {
   document.body.removeChild(notification);
   }, 300);
   }, 3000);
   }
   
   // CSS for notifications
   const style = document.createElement('style');
   style.textContent = `
   @keyframes slideInRight {
   from { transform: translateX(100%); opacity: 0; }
   to { transform: translateX(0); opacity: 1; }
   }
   @keyframes slideOutRight {
   from { transform: translateX(0); opacity: 1; }
   to { transform: translateX(100%); opacity: 0; }
   }
   `;
   document.head.appendChild(style);
   </script>